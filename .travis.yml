language: node_js

node_js:
  - "10"

cache:
  directories:
    - "node_modules"
    - "dist"

stages:
  - setup
  - build
  - deploy

jobs:
  include:
    - stage: setup
      script:
        - npm i
    - stage: build
      script:
        - npm run build
    - stage: deploy
      deploy:
        provider: heroku
        api_key:
          secure: "$HEROKU_API_KEY"
        app: "phb-phonebook-api"
        skip_cleanup: true
